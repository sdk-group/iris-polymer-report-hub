<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iris-polymer-importer/iris-importer.html">


<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-button/paper-button.html">

<link rel="import" href="iris-stepper.html">
<link rel="import" href="iris-template-picker.html">
<link rel="import" href="report-hub-temp.html">

<dom-module id="iris-report-hub">
  <template>
    <style>
      :host {
        display: block;
      }
      
      paper-material {
        padding: 20px 10px;
      }
      
      #pages {
        margin-top: 20px;
      }
      
      .hour-picker {
        @apply(--layout-horizontal);
      }
      
      .picker-col {
        @apply(--layout-vertical);
        width: 40px;
      }
    </style>
    <paper-material id="stepper" elevation="1">
      <iris-stepper steps="[[steps]]" states="{{states}}" selected="{{selectedPage}}"></iris-stepper>
    </paper-material>
    <iron-pages selected="[[selectedPage]]">

      <div id="template-selector">
        <iris-template-picker entities="[[entities]]" template="{{selectedTemplate}}"></iris-template-picker>
      </div>

      <div id="template-office">
        <paper-checkbox>Выделить все</paper-checkbox>
        <template is="dom-repeat" items="[[offices]]">
          <paper-checkbox on-change="selectedOffice">[[item.label]]</paper-checkbox>
        </template>
      </div>

      <div id="intreval-picker">
        <div class="hour-picker">
          <div class="picker-col hours">
            <template is="dom-repeat" items="[[hoursAM]]">
              <span class="hour-item">[[item]]</span>
            </template>
          </div>

          <div class="picker-col hours">
            <template is="dom-repeat" items="[[hoursPM]]">
              <span class="hour-item">[[item]]</span>
            </template>
          </div>
        </div>

        <div class="minute-picker">
          <div class="picker-col minute-decades">
            <template is="dom-repeat" items="[[minutesDec]]">
              <span class="minute-item">[[item]]</span>
            </template>
          </div>

          <div class="picker-col minute-numbers">
            <template is="dom-repeat" items="[[minutesNum]]">
              <span class="minute-item">[[item]]</span>
            </template>
          </div>
        </div>

      </div>

      <div id="table">
      </div>
    </iron-pages>

    <paper-button>Назад</paper-button>
    <paper-button disabled$="[[canNext(selectedPage,selectedTemplate,selectedOffices.length)]]" on-tap="nextPage">Далее</paper-button>
  </template>
  <script>
    'use strict'
    Polymer({
      is: 'iris-report-hub',
      ready() {
        this.steps = ['Шаблон отчета', 'Офис', 'Временной интервал', 'Результат'];
        this.states = Array(this.steps.length);
        this.selectedPage = 0;
        this.entities = ReportHubData.entities;
        this.offices = ReportHubData.offices;
        this.selectedOffices = [];

        this.hoursAM = _.range(0, 12);
        this.hoursPM = _.range(12, 24);
        this.minutesDec = _.range(0, 7);
        this.minutesNum = _.range(0, 10);
      },
      doIndex(index) {
        return index + 1;
      },
      nextPage() {
        this.states[this.selectedPage] = true;
        this.selectedPage += 1;
      },
      selectedOffice(e) {
        let checked = e.target.checked;
        let id = e.model.item.id;

        if (checked) {
          this.push('selectedOffices', id);

        } else {
          this.set('selectedOffices', _.filter(this.selectedOffices, d => d != id));
        }
      },
      canNext(page, template_id, length) {
        console.log(page, template_id, length);
        switch (page) {
          case 0:
            return !template_id;
            break;
          case 1:
            return !length;
            break;
          case 2:
            return false;
            break;
          default:
            return true;
        }
      }
    });
  </script>
</dom-module>