<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iris-polymer-importer/iris-importer.html">
<link rel="import" href="../iris-polymer-date-picker/iris-date-picker.html">
<link rel="import" href="../iris-polymer-styles/iris-mydocs-styles.html">


<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-button/paper-button.html">

<link rel="import" href="iris-stepper.html">
<link rel="import" href="iris-template-picker.html">
<link rel="import" href="report-hub-temp.html">
<link rel="import" href="iris-time-picker.html">

<dom-module id="iris-report-hub">
  <template>
    <style>
      :host {
        display: block;
      }
      
      paper-material {
        padding: 20px 10px;
      }
      
      #pages {
        margin-top: 20px;
      }
    </style>
    <paper-material id="stepper" elevation="1">
      <iris-stepper steps="[[steps]]" states="{{states}}" selected="{{selectedPage}}"></iris-stepper>
    </paper-material>
    <iron-pages selected="[[selectedPage]]">

      <div id="template-selector">
        <iris-template-picker entities="[[entities]]" template="{{selectedTemplate}}"></iris-template-picker>
      </div>

      <div id="template-office">
        <paper-checkbox>Выделить все</paper-checkbox>
        <template is="dom-repeat" items="[[offices]]">
          <paper-checkbox on-change="selectedOffice">[[item.label]]</paper-checkbox>
        </template>
      </div>

      <div id="intreval-picker">
        <iris-time-picker vertical-align="top" hours="{{startHours}}" minutes="{{startMinutes}}"></iris-time-picker>
        <iris-time-picker vertical-align="top" hours="{{endHours}}" minutes="{{endMinutes}}"></iris-time-picker>
        <iris-date-picker selected="{{startDate}}"></iris-date-picker>
        <iris-date-picker selected="{{endDate}}"></iris-date-picker>
      </div>

      <div id="table">
      </div>
    </iron-pages>

    <paper-button>Назад</paper-button>
    <paper-button disabled$="[[canNext(selectedPage,selectedTemplate,selectedOffices.length,startDate,endDate)]]" on-tap="nextPage">Далее</paper-button>
  </template>
  <script>
    'use strict'
    Polymer({
      is: 'iris-report-hub',
      ready() {
        this.steps = ['Шаблон отчета', 'Офис', 'Временной интервал', 'Результат'];
        this.states = Array(this.steps.length);
        this.selectedPage = 0;
        this.entities = ReportHubData.entities;
        this.offices = ReportHubData.offices;
        this.startDate = false;
        this.endDate = false;
        this.selectedOffices = [];
      },
      nextPage() {
        this.states[this.selectedPage] = true;
        this.selectedPage += 1;
        if ((this.selectedPage + 1) == this.steps.length) {
          console.log('request server');
        }
      },
      selectedOffice(e) {
        let checked = e.target.checked;
        let id = e.model.item.id;

        if (checked) {
          this.push('selectedOffices', id);
        } else {
          this.set('selectedOffices', _.filter(this.selectedOffices, d => d != id));
        }
      },
      canNext(page, template_id, length, startDate, endDate) {
        console.log(page, template_id, length);
        switch (page) {
          case 0:
            return !template_id;
            break;
          case 1:
            return !length;
            break;
          case 2:
            console.log(startDate, endDate);
            return !(startDate && endDate);
            break;
          default:
            return true;
        }
      }
    });
  </script>
</dom-module>